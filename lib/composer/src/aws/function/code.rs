pub fn make_transducer_code() -> String {
    format!(
        "aW1wb3J0IGh0dHAuY2xpZW50CmltcG9ydCBqc29uCmltcG9ydCBib3RvMwoKZGVmIG1ha2VfbXV0YXRpb25fc3RyKG11dGF0aW9uX25hbWUsIGlucHV0LCBvdXRwdXQpOgogIGlucCA9ICcnCiAgZm9yIGssdiBpbiBpbnB1dC5pdGVtcygpOgogICAgaW5wICs9IGYnJHtrfTp7dn0sJwogIGlucCA9IGlucC5yc3RyaXAoJywnKQogIGZpZWxkcyA9ICcnCgogIG11dF9pbnB1dCA9ICcnCiAgZm9yIGssdiBpbiBpbnB1dC5pdGVtcygpOgogICAgbXV0X2lucHV0ICs9IGYne2t9OiR7a30sJwogIG11dF9pbnB1dCA9IG11dF9pbnB1dC5yc3RyaXAoJywnKQoKICBmb3IgayBpbiBvdXRwdXQua2V5cygpOgogICAgZmllbGRzICs9IGYne2t9ICcKICBmaWVsZHMgKz0gJ2NyZWF0ZWRBdCB1cGRhdGVkQXQnCiAgcXVlcnkgPSBmJ211dGF0aW9uKHtpbnB9KXt7e211dGF0aW9uX25hbWV9KHttdXRfaW5wdXR9KXt7e2ZpZWxkc319fX19JwogIHJldHVybiBxdWVyeQoKCmRlZiBtYWtlX211dGF0aW9uX3BheWxvYWQobXV0YXRpb25fbmFtZSwgaW5wdXQsIG91dHB1dCwgdmFyaWFibGVzKToKICBtdXRfc3RyID0gbWFrZV9tdXRhdGlvbl9zdHIobXV0YXRpb25fbmFtZSwgaW5wdXQsIG91dHB1dCkKICB2YXJpYWJsZXMgPSBqc29uLmR1bXBzKHZhcmlhYmxlcykKICBncmFwaHFsX211dGF0aW9uID0gewogICAgJ3F1ZXJ5JzogbXV0X3N0ciwKICAgICd2YXJpYWJsZXMnOiBmJ3t2YXJpYWJsZXN9JwogIH0KICByZXR1cm4ganNvbi5kdW1wcyhncmFwaHFsX211dGF0aW9uKQoKZGVmIHRyaWdnZXJfbXV0YXRpb24obXV0YXRpb25fbWV0YWRhdGEsIHZhcmlhYmxlcyk6CiAgbXV0YXRpb25fbmFtZSA9IG11dGF0aW9uX21ldGFkYXRhLmdldCgnbmFtZScpCiAgaW5wdXQgPSBtdXRhdGlvbl9tZXRhZGF0YS5nZXQoJ2lucHV0JykKICBvdXRwdXQgPSBtdXRhdGlvbl9tZXRhZGF0YS5nZXQoJ291dHB1dCcpCiAgZW5kcG9pbnQgPSBtdXRhdGlvbl9tZXRhZGF0YS5nZXQoJ2VuZHBvaW50JykKICBhcGlfa2V5ID0gbXV0YXRpb25fbWV0YWRhdGEuZ2V0KCdhcGlfa2V5JykKICBob3N0ID0gZW5kcG9pbnQucmVwbGFjZSgnaHR0cHM6Ly8nLCcnKS5yZXBsYWNlKCcvZ3JhcGhxbCcsJycpCgogIGNvbm4gPSBodHRwLmNsaWVudC5IVFRQU0Nvbm5lY3Rpb24oaG9zdCwgNDQzKQogIGhlYWRlcnMgPSB7CiAgICAgICAgJ0NvbnRlbnQtdHlwZSc6ICdhcHBsaWNhdGlvbi9ncmFwaHFsJywKICAgICAgICAneC1hcGkta2V5JzogYXBpX2tleSwKICAgICAgICAnaG9zdCc6IGhvc3QKICAgIH0KICByZXN0X3BheWxvYWQgPSBtYWtlX211dGF0aW9uX3BheWxvYWQobXV0YXRpb25fbmFtZSwgaW5wdXQsIG91dHB1dCwgdmFyaWFibGVzKQogIGNvbm4ucmVxdWVzdCgnUE9TVCcsICcvZ3JhcGhxbCcsIHJlc3RfcGF5bG9hZCwgaGVhZGVycykKICByZXNwb25zZSA9IGNvbm4uZ2V0cmVzcG9uc2UoKQogIHJlc3BvbnNlX3N0cmluZyA9IHJlc3BvbnNlLnJlYWQoKS5kZWNvZGUoJ3V0Zi04JykKICBwcmludChyZXNwb25zZV9zdHJpbmcpCiAgcmV0dXJuIHJlc3BvbnNlX3N0cmluZwoKZGVmIHRyaWdnZXJfZXZlbnQoZXZlbnRfbWV0YWRhdGEsIHBheWxvYWQpOgogIGNsaWVudCA9IGJvdG8zLmNsaWVudCgnZXZlbnRzJykKICByZXMgPSBjbGllbnQucHV0X2V2ZW50cygKICAgIEVudHJpZXM9WwogICAgICB7CiAgICAgICAgJ1NvdXJjZSc6IGV2ZW50X21ldGFkYXRhLmdldCgnc291cmNlJyksCiAgICAgICAgJ0V2ZW50QnVzTmFtZSc6IGV2ZW50X21ldGFkYXRhLmdldCgnYnVzJyksCiAgICAgICAgJ0RldGFpbCc6IGpzb24uZHVtcHMocGF5bG9hZCksCiAgICAgICAgJ0RldGFpbFR5cGUnOiBldmVudF9tZXRhZGF0YS5nZXQoJ25hbWUnKQogICAgICB9CiAgICBdCiAgKQogIHByaW50KHJlcykKICByZXR1cm4gcmVzCgpkZWYgdHJpZ2dlcl9mdW5jdGlvbihmdW5jdGlvbl9hcm4sIHBheWxvYWQpOgogIGNsaWVudCA9IGJvdG8zLmNsaWVudCgnbGFtYmRhJykKICByZXNwb25zZSA9IGNsaWVudC5pbnZva2VfYXN5bmMoCiAgICAgICAgRnVuY3Rpb25OYW1lPWZ1bmN0aW9uX2FybiwKICAgICAgICBJbnZva2VBcmdzPWpzb24uZHVtcHMocGF5bG9hZCkKICApCiAgcHJpbnQocmVzcG9uc2UpCiAgcmV0dXJuIHJlc3BvbnNlCgpkZWYgdHJpZ2dlcl9jaGFubmVsKGNoYW5uZWxfbWV0YWRhdGEsIHBheWxvYWQpOgogIGhvc3QgPSBjaGFubmVsX21ldGFkYXRhLmdldCgnaHR0cF9kb21haW4nKQogIGFwaV9rZXkgPSBjaGFubmVsX21ldGFkYXRhLmdldCgnYXBpX2tleScpCiAgY29ubiA9IGh0dHAuY2xpZW50LkhUVFBTQ29ubmVjdGlvbihob3N0LCA0NDMpCiAgaGVhZGVycyA9IHsKICAgICdDb250ZW50LXR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAneC1hcGkta2V5JzogYXBpX2tleSwKICB9CiAgYm9keSA9IHsKICAgICdjaGFubmVsJzogY2hhbm5lbF9tZXRhZGF0YS5nZXQoJ25hbWUnKSwKICAgICdldmVudHMnOiBbanNvbi5kdW1wcyhwYXlsb2FkKV0KICB9CiAgY29ubi5yZXF1ZXN0KCdQT1NUJywgJy9ldmVudCcsIGpzb24uZHVtcHMoYm9keSksIGhlYWRlcnMpCiAgcmVzcG9uc2UgPSBjb25uLmdldHJlc3BvbnNlKCkKICByZXNwb25zZV9zdHJpbmcgPSByZXNwb25zZS5yZWFkKCkuZGVjb2RlKCd1dGYtOCcpCiAgcHJpbnQocmVzcG9uc2Vfc3RyaW5nKQogIHJldHVybiByZXNwb25zZV9zdHJpbmcKCmRlZiB0cmlnZ2VyX3RhcmdldHModGFyZ2V0cywgcGF5bG9hZCk6CiAgZXZlbnRfbWV0YWRhdGEgPSB0YXJnZXRzLmdldCgiZXZlbnQiKQogIG11dGF0aW9uX21ldGFkYXRhID0gdGFyZ2V0cy5nZXQoIm11dGF0aW9uIikKICBmdW5jdGlvbl9hcm4gPSB0YXJnZXRzLmdldCgiZnVuY3Rpb24iKQogIGNoYW5uZWxfbWV0YWRhdGEgPSB0YXJnZXRzLmdldCgiY2hhbm5lbCIpCiAgaWYgZXZlbnRfbWV0YWRhdGEgaXMgbm90IE5vbmU6CiAgICB0cmlnZ2VyX2V2ZW50KGV2ZW50X21ldGFkYXRhLCBwYXlsb2FkKQoKICBpZiBmdW5jdGlvbl9hcm4gaXMgbm90IE5vbmU6CiAgICB0cmlnZ2VyX2Z1bmN0aW9uKGZ1bmN0aW9uX2FybiwgcGF5bG9hZCkKCiAgaWYgbXV0YXRpb25fbWV0YWRhdGEgaXMgbm90IE5vbmU6CiAgICB0cmlnZ2VyX211dGF0aW9uKG11dGF0aW9uX21ldGFkYXRhLCBwYXlsb2FkKQoKICBpZiBjaGFubmVsX21ldGFkYXRhIGlzIG5vdCBOb25lOgogICAgdHJpZ2dlcl9jaGFubmVsKGNoYW5uZWxfbWV0YWRhdGEsIHBheWxvYWQpCiAgcmV0dXJuIFRydWUKCmRlZiBsb2FkX21ldGFkYXRhKHNvdXJjZV9hcm4pOgogIHdpdGggb3BlbigndHJhbnNkdWNlci5qc29uJykgYXMganNvbl9kYXRhOgogICAgZCA9IGpzb24ubG9hZChqc29uX2RhdGEpCiAgICB0YXJnZXRzID0gZC5nZXQoJ3RhcmdldHMnKS5nZXQoc291cmNlX2FybikKICAgIGpzb25fZGF0YS5jbG9zZSgpCiAgICByZXR1cm4gdGFyZ2V0cwoKZGVmIG1ha2VfaW5wdXQocmVzcG9uc2VfcGF5bG9hZCk6CiAgaWYgJ2RldGFpbCcgaW4gcmVzcG9uc2VfcGF5bG9hZCBhbmQgJ2RldGFpbC10eXBlJyBpbiByZXNwb25zZV9wYXlsb2FkOgogICAgcmV0dXJuIHJlc3BvbnNlX3BheWxvYWQuZ2V0KCdkZXRhaWwnKQogIGVsc2U6CiAgICByZXR1cm4gcmVzcG9uc2VfcGF5bG9hZAoKCmRlZiBoYW5kbGVyKGV2ZW50LCBjb250ZXh0KToKICBwcmludChldmVudCkKICBpbnB1dCA9IG1ha2VfaW5wdXQoZXZlbnQuZ2V0KCdyZXNwb25zZVBheWxvYWQnKSkKICBzID0gZXZlbnQuZ2V0KCdyZXF1ZXN0Q29udGV4dCcpLmdldCgnZnVuY3Rpb25Bcm4nKQogIHNvdXJjZV9hcm4gPSBzLnJzcGxpdCgnOicsIDEpWzBdCiAgdGFyZ2V0cyA9IGxvYWRfbWV0YWRhdGEoc291cmNlX2FybikKICByZXMgPSB0cmlnZ2VyX3RhcmdldHModGFyZ2V0cywgaW5wdXQpCiAgcmV0dXJuIHJlcwo="
    )
}
